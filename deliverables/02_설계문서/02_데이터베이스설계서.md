# 데이터베이스 설계서

**프로젝트명**: 푸름대학교 학생성장지원센터 CHAMP (SCMS3)
**작성일**: 2025-11-18
**버전**: 1.0
**작성자**: 개발팀
**데이터베이스**: MySQL 8.0

---

## 1. 문서 개요

### 1.1 목적
본 문서는 SCMS3 시스템의 데이터베이스 구조를 상세히 기술하여, 테이블 설계, 관계, 인덱스, 제약조건 등을 명확히 제시합니다.

### 1.2 범위
- 데이터베이스 ERD (Entity Relationship Diagram)
- 테이블 상세 명세
- 관계 및 제약조건
- 인덱스 전략
- 데이터베이스 설정

### 1.3 대상 독자
- 데이터베이스 관리자
- 백엔드 개발자
- 시스템 아키텍트

---

## 2. 데이터베이스 개요

### 2.1 데이터베이스 정보
| 항목 | 내용 |
|------|------|
| DBMS | MySQL |
| 버전 | 8.0 이상 |
| 문자셋 | utf8mb4 |
| Collation | utf8mb4_unicode_ci |
| 데이터베이스명 | scms2 |
| 스토리지 엔진 | InnoDB |
| 트랜잭션 지원 | Yes |

### 2.2 설계 원칙
1. **정규화**: 제3정규형(3NF)까지 적용
2. **Soft Delete**: 물리적 삭제 대신 논리적 삭제 (deleted_at 컬럼)
3. **타임스탬프**: 모든 테이블에 created_at, updated_at 컬럼
4. **외래키 제약**: 참조 무결성 보장
5. **인덱스 최적화**: 검색 성능 향상을 위한 인덱스 설정

---

## 3. ERD (Entity Relationship Diagram)

### 3.1 전체 ERD 개요

```
┌─────────────────────────────────────────────────────────────────────┐
│                         User Management                              │
│  ┌──────────┐     ┌──────────┐     ┌──────────────┐                │
│  │  users   │────▷│ students │     │ counselors   │                │
│  └──────────┘     └──────────┘     └──────────────┘                │
│       │                                    │                         │
│       │                                    │                         │
└───────┼────────────────────────────────────┼─────────────────────────┘
        │                                    │
        │                                    │
┌───────┼────────────────────────────────────┼─────────────────────────┐
│       │             Program Management     │                         │
│       │                                    │                         │
│  ┌────▼──────┐        ┌──────────┐   ┌────▼──────────────┐         │
│  │ programs  │◁───────│ program_ │   │ consultation_     │         │
│  └───────────┘        │ competency│   │ sessions          │         │
│       │               └──────────┘   └───────────────────┘         │
│       │                     │                  │                     │
│       │               ┌─────▼────┐       ┌─────▼──────────┐         │
│  ┌────▼──────────┐   │competency│       │ consultation_  │         │
│  │ program_      │   │categories│       │ records        │         │
│  │ applications  │   └──────────┘       └────────────────┘         │
│  └───────────────┘         │                                        │
│       │               ┌────▼────────────────────┐                   │
│  ┌────▼──────────┐   │ student_competency_     │                   │
│  │ program_      │   │ assessments             │                   │
│  │ reviews       │   └─────────────────────────┘                   │
│  └───────────────┘                                                  │
│       │                                                              │
│  ┌────▼──────────┐                                                  │
│  │ program_files │                                                  │
│  └───────────────┘                                                  │
└─────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────┐
│                    Mileage & Portfolio                               │
│  ┌──────────────┐    ┌─────────────┐    ┌──────────────┐           │
│  │ mileage_     │    │ portfolios  │    │ portfolio_   │           │
│  │ history      │    └─────────────┘    │ items        │           │
│  └──────────────┘          │            └──────────────┘           │
│  ┌──────────────┐          │                  │                     │
│  │ mileage_     │     ┌────▼──────────┐  ┌────▼──────────┐         │
│  │ rules        │     │ portfolio_    │  │ portfolio_    │         │
│  └──────────────┘     │ files         │  │ shares        │         │
│                       └───────────────┘  └───────────────┘         │
│                       ┌───────────────┐                             │
│                       │ portfolio_    │                             │
│                       │ views         │                             │
│                       └───────────────┘                             │
└─────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────┐
│                       Survey & Notification                          │
│  ┌──────────────┐    ┌─────────────┐    ┌──────────────┐           │
│  │ surveys      │    │notifications│    │ login_       │           │
│  └──────────────┘    └─────────────┘    │ history      │           │
│       │                                  └──────────────┘           │
│  ┌────▼──────────┐                                                  │
│  │ survey_       │         ┌──────────────────┐                     │
│  │ questions     │         │ external_        │                     │
│  └───────────────┘         │ employment       │                     │
│       │                    └──────────────────┘                     │
│  ┌────▼──────────┐         ┌──────────────────┐                     │
│  │ survey_       │         │ external_        │                     │
│  │ question_     │         │ employment_      │                     │
│  │ options       │         │ credit_rules     │                     │
│  └───────────────┘         └──────────────────┘                     │
│       │                                                              │
│  ┌────▼──────────┐                                                  │
│  │ survey_       │                                                  │
│  │ responses     │                                                  │
│  └───────────────┘                                                  │
│       │                                                              │
│  ┌────▼──────────┐                                                  │
│  │ survey_       │                                                  │
│  │ answers       │                                                  │
│  └───────────────┘                                                  │
│  ┌───────────────┐                                                  │
│  │ survey_       │                                                  │
│  │ targets       │                                                  │
│  └───────────────┘                                                  │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 4. 테이블 상세 명세

### 4.1 사용자 관리 (User Management)

#### 4.1.1 users (사용자)

**설명**: 시스템 전체 사용자 정보 (학생, 상담사, 관리자 통합)

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| user_id | INT | NO | PK, AUTO_INCREMENT | - | 사용자 ID |
| student_num | INT | NO | UNIQUE | - | 학번 |
| name | VARCHAR(50) | NO | - | - | 이름 |
| email | VARCHAR(100) | NO | UNIQUE | - | 이메일 |
| phone | VARCHAR(100) | YES | - | - | 전화번호 |
| password | VARCHAR(255) | YES | - | - | 비밀번호 (BCrypt) |
| birth_date | DATE | NO | - | - | 생년월일 |
| department | VARCHAR(100) | YES | - | - | 학과 |
| grade | INT | YES | - | - | 학년 |
| role | VARCHAR(20) | NO | INDEX | 'STUDENT' | 역할 (STUDENT/COUNSELOR/ADMIN) |
| locked | TINYINT(1) | NO | - | 0 | 계정 잠금 여부 |
| fail_cnt | INT | NO | - | 0 | 로그인 실패 횟수 |
| created_at | DATETIME | NO | - | CURRENT_TIMESTAMP | 생성일시 |
| updated_at | DATETIME | YES | - | CURRENT_TIMESTAMP | 수정일시 |
| deleted_at | DATETIME | YES | INDEX | NULL | 삭제일시 (Soft Delete) |

**인덱스**:
- PRIMARY KEY: user_id
- UNIQUE: student_num, email
- INDEX: role, deleted_at

**관계**:
- 1:N → students (user_id)
- 1:N → counselors (counselor_id)
- 1:N → program_applications
- 1:N → mileage_history
- 1:N → consultation_sessions
- 1:N → portfolios
- 1:N → notifications

---

#### 4.1.2 students (학생)

**설명**: 학생 상세 정보

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| id | BIGINT | NO | PK, AUTO_INCREMENT | - | 학생 ID |
| student_id | VARCHAR(50) | NO | UNIQUE | - | 학번 |
| name | VARCHAR(100) | NO | - | - | 이름 |
| email | VARCHAR(100) | NO | UNIQUE | - | 이메일 |
| phone | VARCHAR(20) | YES | - | - | 전화번호 |
| department | VARCHAR(100) | YES | INDEX | - | 학과 |
| grade | VARCHAR(20) | YES | - | - | 학년 |
| status | VARCHAR(20) | YES | - | '재학' | 상태 (재학/휴학/졸업/자퇴) |
| created_at | DATETIME | NO | - | CURRENT_TIMESTAMP | 생성일시 |
| updated_at | DATETIME | YES | - | CURRENT_TIMESTAMP | 수정일시 |

**인덱스**:
- PRIMARY KEY: id
- UNIQUE: student_id, email
- INDEX: department

---

#### 4.1.3 counselors (상담사)

**설명**: 상담사 정보 (users 테이블과 1:1 관계)

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| counselor_id | INT | NO | PK, FK | - | 상담사 ID (= user_id) |
| special | VARCHAR(100) | YES | - | - | 전문 분야 |
| intro | TEXT | YES | - | - | 소개 |
| created_at | DATETIME | NO | - | CURRENT_TIMESTAMP | 생성일시 |
| updated_at | DATETIME | YES | - | CURRENT_TIMESTAMP | 수정일시 |
| deleted_at | DATETIME | YES | - | NULL | 삭제일시 (Soft Delete) |

**인덱스**:
- PRIMARY KEY: counselor_id
- FOREIGN KEY: counselor_id → users(user_id) ON DELETE CASCADE

**관계**:
- N:1 → users (counselor_id = user_id)
- 1:N → counselor_schedules
- 1:N → consultation_sessions

---

#### 4.1.4 login_history (로그인 이력)

**설명**: 사용자 로그인 기록

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| id | BIGINT | NO | PK, AUTO_INCREMENT | - | ID |
| user_id | INT | NO | FK, INDEX | - | 사용자 ID |
| login_time | DATETIME | NO | INDEX | CURRENT_TIMESTAMP | 로그인 시간 |
| ip_address | VARCHAR(50) | YES | - | - | IP 주소 |
| user_agent | VARCHAR(255) | YES | - | - | User Agent |
| success | TINYINT(1) | NO | - | - | 성공 여부 |
| fail_reason | VARCHAR(100) | YES | - | - | 실패 사유 |

**인덱스**:
- PRIMARY KEY: id
- INDEX: user_id, login_time
- FOREIGN KEY: user_id → users(user_id) ON DELETE CASCADE

---

### 4.2 프로그램 관리 (Program Management)

#### 4.2.1 programs (프로그램)

**설명**: 비교과 프로그램 정보

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| id | BIGINT | NO | PK, AUTO_INCREMENT | - | 프로그램 ID |
| title | VARCHAR(200) | NO | INDEX | - | 제목 |
| description | TEXT | YES | - | - | 설명 |
| department | VARCHAR(100) | YES | INDEX | - | 주관 부서 |
| category | VARCHAR(100) | YES | INDEX | - | 카테고리 |
| start_date | DATE | YES | INDEX | - | 시작일 |
| end_date | DATE | YES | - | - | 종료일 |
| application_start | DATETIME | YES | - | - | 신청 시작일시 |
| application_end | DATETIME | YES | - | - | 신청 종료일시 |
| capacity | INT | YES | - | 0 | 정원 |
| current_participants | INT | NO | - | 0 | 현재 참여 인원 |
| location | VARCHAR(200) | YES | - | - | 장소 |
| mileage_points | INT | YES | - | 0 | 마일리지 점수 |
| instructor | VARCHAR(100) | YES | - | - | 강사/담당자 |
| status | VARCHAR(20) | NO | INDEX | 'UPCOMING' | 상태 (UPCOMING/ONGOING/COMPLETED/CANCELLED) |
| created_at | DATETIME | NO | - | CURRENT_TIMESTAMP | 생성일시 |
| updated_at | DATETIME | YES | - | CURRENT_TIMESTAMP | 수정일시 |
| deleted_at | DATETIME | YES | INDEX | NULL | 삭제일시 (Soft Delete) |

**인덱스**:
- PRIMARY KEY: id
- INDEX: title, department, category, status, start_date, deleted_at

**관계**:
- 1:N → program_applications
- 1:N → program_files
- 1:N → program_reviews
- 1:N → program_competencies

---

#### 4.2.2 program_applications (프로그램 신청)

**설명**: 프로그램 신청 정보

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| id | BIGINT | NO | PK, AUTO_INCREMENT | - | 신청 ID |
| program_id | BIGINT | NO | FK, INDEX | - | 프로그램 ID |
| user_id | INT | NO | FK, INDEX | - | 사용자 ID |
| status | VARCHAR(20) | NO | INDEX | 'PENDING' | 상태 (PENDING/APPROVED/REJECTED/CANCELLED) |
| application_date | DATETIME | NO | - | CURRENT_TIMESTAMP | 신청일시 |
| processed_date | DATETIME | YES | - | - | 처리일시 |
| processed_by | INT | YES | FK | - | 처리자 ID |
| notes | TEXT | YES | - | - | 비고 |
| attendance_status | VARCHAR(20) | YES | - | - | 출석 상태 |
| completion_date | DATE | YES | - | - | 수료일 |
| created_at | DATETIME | NO | - | CURRENT_TIMESTAMP | 생성일시 |
| updated_at | DATETIME | YES | - | CURRENT_TIMESTAMP | 수정일시 |
| deleted_at | DATETIME | YES | INDEX | NULL | 삭제일시 |

**인덱스**:
- PRIMARY KEY: id
- INDEX: program_id, user_id, status, deleted_at
- FOREIGN KEY: program_id → programs(id) ON DELETE CASCADE
- FOREIGN KEY: user_id → users(user_id) ON DELETE CASCADE
- FOREIGN KEY: processed_by → users(user_id)

---

#### 4.2.3 program_files (프로그램 첨부파일)

**설명**: 프로그램 관련 파일

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| id | BIGINT | NO | PK, AUTO_INCREMENT | - | 파일 ID |
| program_id | BIGINT | NO | FK, INDEX | - | 프로그램 ID |
| original_filename | VARCHAR(255) | NO | - | - | 원본 파일명 |
| stored_filename | VARCHAR(255) | NO | - | - | 저장 파일명 (UUID) |
| file_path | VARCHAR(500) | NO | - | - | 파일 경로 |
| file_size | BIGINT | YES | - | - | 파일 크기 (bytes) |
| content_type | VARCHAR(100) | YES | - | - | MIME 타입 |
| uploaded_by | INT | NO | FK | - | 업로드한 사용자 ID |
| created_at | DATETIME | NO | - | CURRENT_TIMESTAMP | 생성일시 |
| deleted_at | DATETIME | YES | INDEX | NULL | 삭제일시 |

**인덱스**:
- PRIMARY KEY: id
- INDEX: program_id, deleted_at
- FOREIGN KEY: program_id → programs(id) ON DELETE CASCADE
- FOREIGN KEY: uploaded_by → users(user_id)

---

#### 4.2.4 program_reviews (프로그램 평가)

**설명**: 프로그램 평가 및 리뷰

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| id | BIGINT | NO | PK, AUTO_INCREMENT | - | 평가 ID |
| program_id | BIGINT | NO | FK, INDEX | - | 프로그램 ID |
| user_id | INT | NO | FK, INDEX | - | 사용자 ID |
| rating | INT | NO | - | - | 평점 (1-5) |
| comment | TEXT | YES | - | - | 코멘트 |
| created_at | DATETIME | NO | INDEX | CURRENT_TIMESTAMP | 생성일시 |
| updated_at | DATETIME | YES | - | CURRENT_TIMESTAMP | 수정일시 |
| deleted_at | DATETIME | YES | INDEX | NULL | 삭제일시 |

**인덱스**:
- PRIMARY KEY: id
- INDEX: program_id, user_id, created_at, deleted_at
- FOREIGN KEY: program_id → programs(id) ON DELETE CASCADE
- FOREIGN KEY: user_id → users(user_id) ON DELETE CASCADE

---

### 4.3 역량 관리 (Competency Management)

#### 4.3.1 competency_categories (역량 카테고리)

**설명**: 역량 카테고리 (예: 의사소통, 문제해결, 창의성, 협업)

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| id | BIGINT | NO | PK, AUTO_INCREMENT | - | 카테고리 ID |
| name | VARCHAR(100) | NO | - | - | 카테고리명 |
| description | TEXT | YES | - | - | 설명 |
| created_at | DATETIME | NO | - | CURRENT_TIMESTAMP | 생성일시 |
| updated_at | DATETIME | YES | - | CURRENT_TIMESTAMP | 수정일시 |

**인덱스**:
- PRIMARY KEY: id

---

#### 4.3.2 competencies (역량)

**설명**: 세부 역량 항목

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| id | BIGINT | NO | PK, AUTO_INCREMENT | - | 역량 ID |
| category_id | BIGINT | NO | FK, INDEX | - | 카테고리 ID |
| name | VARCHAR(100) | NO | - | - | 역량명 |
| description | TEXT | YES | - | - | 설명 |
| created_at | DATETIME | NO | - | CURRENT_TIMESTAMP | 생성일시 |
| updated_at | DATETIME | YES | - | CURRENT_TIMESTAMP | 수정일시 |

**인덱스**:
- PRIMARY KEY: id
- INDEX: category_id
- FOREIGN KEY: category_id → competency_categories(id) ON DELETE CASCADE

---

#### 4.3.3 student_competency_assessments (학생 역량 평가)

**설명**: 학생 역량 진단 결과

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| id | BIGINT | NO | PK, AUTO_INCREMENT | - | 평가 ID |
| student_id | BIGINT | NO | FK, INDEX | - | 학생 ID |
| competency_id | BIGINT | NO | FK, INDEX | - | 역량 ID |
| score | INT | NO | - | - | 점수 (0-100) |
| assessment_date | DATE | NO | INDEX | - | 평가일 |
| assessor | VARCHAR(100) | YES | - | - | 평가자 |
| notes | TEXT | YES | - | - | 비고 |
| created_at | DATETIME | NO | - | CURRENT_TIMESTAMP | 생성일시 |
| updated_at | DATETIME | YES | - | CURRENT_TIMESTAMP | 수정일시 |

**인덱스**:
- PRIMARY KEY: id
- INDEX: student_id, competency_id, assessment_date
- FOREIGN KEY: student_id → students(id) ON DELETE CASCADE
- FOREIGN KEY: competency_id → competencies(id) ON DELETE CASCADE

---

#### 4.3.4 program_competencies (프로그램-역량 매핑)

**설명**: 프로그램과 역량 간의 매핑

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| id | BIGINT | NO | PK, AUTO_INCREMENT | - | ID |
| program_id | BIGINT | NO | FK, INDEX | - | 프로그램 ID |
| competency_id | BIGINT | NO | FK, INDEX | - | 역량 ID |
| weight | DECIMAL(5,2) | YES | - | 1.0 | 가중치 |

**인덱스**:
- PRIMARY KEY: id
- INDEX: program_id, competency_id
- FOREIGN KEY: program_id → programs(id) ON DELETE CASCADE
- FOREIGN KEY: competency_id → competencies(id) ON DELETE CASCADE

---

### 4.4 마일리지 시스템 (Mileage System)

#### 4.4.1 mileage_history (마일리지 이력)

**설명**: 마일리지 적립/차감 내역

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| id | BIGINT | NO | PK, AUTO_INCREMENT | - | 이력 ID |
| user_id | INT | NO | FK, INDEX | - | 사용자 ID |
| points | INT | NO | - | - | 점수 (양수: 적립, 음수: 차감) |
| reason | VARCHAR(200) | YES | - | - | 사유 |
| reference_type | VARCHAR(50) | YES | - | - | 참조 타입 (PROGRAM, SURVEY 등) |
| reference_id | BIGINT | YES | - | - | 참조 ID |
| balance | INT | NO | - | 0 | 잔액 |
| created_at | DATETIME | NO | INDEX | CURRENT_TIMESTAMP | 생성일시 |

**인덱스**:
- PRIMARY KEY: id
- INDEX: user_id, created_at
- FOREIGN KEY: user_id → users(user_id) ON DELETE CASCADE

---

#### 4.4.2 mileage_rules (마일리지 규칙)

**설명**: 마일리지 적립 규칙

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| id | BIGINT | NO | PK, AUTO_INCREMENT | - | 규칙 ID |
| activity_type | VARCHAR(50) | NO | UNIQUE | - | 활동 유형 |
| points | INT | NO | - | - | 점수 |
| description | TEXT | YES | - | - | 설명 |
| is_active | TINYINT(1) | NO | - | 1 | 활성 여부 |
| created_at | DATETIME | NO | - | CURRENT_TIMESTAMP | 생성일시 |
| updated_at | DATETIME | YES | - | CURRENT_TIMESTAMP | 수정일시 |

**인덱스**:
- PRIMARY KEY: id
- UNIQUE: activity_type

---

### 4.5 상담 관리 (Counseling Management)

#### 4.5.1 consultation_sessions (상담 세션)

**설명**: 상담 신청 및 일정

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| id | BIGINT | NO | PK, AUTO_INCREMENT | - | 세션 ID |
| student_id | INT | NO | FK, INDEX | - | 학생 ID |
| counselor_id | INT | YES | FK, INDEX | - | 상담사 ID |
| consultation_type | VARCHAR(20) | YES | - | - | 상담 유형 |
| status | VARCHAR(20) | NO | INDEX | 'PENDING' | 상태 (PENDING/CONFIRMED/COMPLETED/CANCELLED) |
| scheduled_date | DATE | YES | INDEX | - | 예정 일자 |
| scheduled_time | TIME | YES | - | - | 예정 시간 |
| duration_minutes | INT | YES | - | 60 | 예상 소요 시간 (분) |
| topic | VARCHAR(200) | YES | - | - | 상담 주제 |
| notes | TEXT | YES | - | - | 비고 |
| created_at | DATETIME | NO | - | CURRENT_TIMESTAMP | 생성일시 |
| updated_at | DATETIME | YES | - | CURRENT_TIMESTAMP | 수정일시 |
| deleted_at | DATETIME | YES | INDEX | NULL | 삭제일시 |

**인덱스**:
- PRIMARY KEY: id
- INDEX: student_id, counselor_id, status, scheduled_date, deleted_at
- FOREIGN KEY: student_id → users(user_id) ON DELETE CASCADE
- FOREIGN KEY: counselor_id → counselors(counselor_id)

---

#### 4.5.2 consultation_records (상담 기록)

**설명**: 상담 완료 후 기록

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| id | BIGINT | NO | PK, AUTO_INCREMENT | - | 기록 ID |
| session_id | BIGINT | NO | FK, UNIQUE | - | 세션 ID |
| summary | TEXT | YES | - | - | 요약 |
| details | TEXT | YES | - | - | 상세 내용 |
| follow_up_needed | TINYINT(1) | NO | - | 0 | 후속 상담 필요 여부 |
| next_session_date | DATE | YES | - | - | 다음 상담 예정일 |
| created_at | DATETIME | NO | - | CURRENT_TIMESTAMP | 생성일시 |
| updated_at | DATETIME | YES | - | CURRENT_TIMESTAMP | 수정일시 |

**인덱스**:
- PRIMARY KEY: id
- UNIQUE: session_id
- FOREIGN KEY: session_id → consultation_sessions(id) ON DELETE CASCADE

---

#### 4.5.3 counselor_schedules (상담사 일정)

**설명**: 상담사 가용 일정

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| id | BIGINT | NO | PK, AUTO_INCREMENT | - | 일정 ID |
| counselor_id | INT | NO | FK, INDEX | - | 상담사 ID |
| day_of_week | INT | NO | - | - | 요일 (1=월, 7=일) |
| start_time | TIME | NO | - | - | 시작 시간 |
| end_time | TIME | NO | - | - | 종료 시간 |
| is_available | TINYINT(1) | NO | - | 1 | 가용 여부 |
| created_at | DATETIME | NO | - | CURRENT_TIMESTAMP | 생성일시 |
| updated_at | DATETIME | YES | - | CURRENT_TIMESTAMP | 수정일시 |

**인덱스**:
- PRIMARY KEY: id
- INDEX: counselor_id
- FOREIGN KEY: counselor_id → counselors(counselor_id) ON DELETE CASCADE

---

### 4.6 포트폴리오 관리 (Portfolio Management)

#### 4.6.1 portfolios (포트폴리오)

**설명**: 학생 포트폴리오 메인

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| id | BIGINT | NO | PK, AUTO_INCREMENT | - | 포트폴리오 ID |
| user_id | INT | NO | FK, UNIQUE | - | 사용자 ID |
| title | VARCHAR(200) | YES | - | - | 제목 |
| bio | TEXT | YES | - | - | 자기소개 |
| visibility | VARCHAR(20) | NO | - | 'PRIVATE' | 공개 범위 (PRIVATE/PUBLIC/SHARED) |
| created_at | DATETIME | NO | - | CURRENT_TIMESTAMP | 생성일시 |
| updated_at | DATETIME | YES | - | CURRENT_TIMESTAMP | 수정일시 |
| deleted_at | DATETIME | YES | INDEX | NULL | 삭제일시 |

**인덱스**:
- PRIMARY KEY: id
- UNIQUE: user_id
- INDEX: deleted_at
- FOREIGN KEY: user_id → users(user_id) ON DELETE CASCADE

---

#### 4.6.2 portfolio_items (포트폴리오 항목)

**설명**: 포트폴리오 개별 항목

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| id | BIGINT | NO | PK, AUTO_INCREMENT | - | 항목 ID |
| portfolio_id | BIGINT | NO | FK, INDEX | - | 포트폴리오 ID |
| item_type | VARCHAR(20) | NO | - | - | 항목 유형 (PROGRAM/CERTIFICATE/PROJECT/ACTIVITY) |
| title | VARCHAR(200) | NO | - | - | 제목 |
| description | TEXT | YES | - | - | 설명 |
| start_date | DATE | YES | - | - | 시작일 |
| end_date | DATE | YES | - | - | 종료일 |
| organization | VARCHAR(200) | YES | - | - | 기관/단체 |
| created_at | DATETIME | NO | - | CURRENT_TIMESTAMP | 생성일시 |
| updated_at | DATETIME | YES | - | CURRENT_TIMESTAMP | 수정일시 |
| deleted_at | DATETIME | YES | INDEX | NULL | 삭제일시 |

**인덱스**:
- PRIMARY KEY: id
- INDEX: portfolio_id, deleted_at
- FOREIGN KEY: portfolio_id → portfolios(id) ON DELETE CASCADE

---

#### 4.6.3 portfolio_files (포트폴리오 파일)

**설명**: 포트폴리오 첨부 파일

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| id | BIGINT | NO | PK, AUTO_INCREMENT | - | 파일 ID |
| portfolio_item_id | BIGINT | NO | FK, INDEX | - | 포트폴리오 항목 ID |
| original_filename | VARCHAR(255) | NO | - | - | 원본 파일명 |
| stored_filename | VARCHAR(255) | NO | - | - | 저장 파일명 |
| file_path | VARCHAR(500) | NO | - | - | 파일 경로 |
| file_size | BIGINT | YES | - | - | 파일 크기 (bytes) |
| content_type | VARCHAR(100) | YES | - | - | MIME 타입 |
| created_at | DATETIME | NO | - | CURRENT_TIMESTAMP | 생성일시 |
| deleted_at | DATETIME | YES | INDEX | NULL | 삭제일시 |

**인덱스**:
- PRIMARY KEY: id
- INDEX: portfolio_item_id, deleted_at
- FOREIGN KEY: portfolio_item_id → portfolio_items(id) ON DELETE CASCADE

---

#### 4.6.4 portfolio_shares (포트폴리오 공유)

**설명**: 포트폴리오 공유 설정

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| id | BIGINT | NO | PK, AUTO_INCREMENT | - | 공유 ID |
| portfolio_id | BIGINT | NO | FK, INDEX | - | 포트폴리오 ID |
| shared_with_user_id | INT | YES | FK | - | 공유 대상 사용자 ID (NULL=전체공개) |
| share_token | VARCHAR(100) | YES | UNIQUE | - | 공유 토큰 (URL용) |
| expires_at | DATETIME | YES | - | - | 만료일시 |
| created_at | DATETIME | NO | - | CURRENT_TIMESTAMP | 생성일시 |

**인덱스**:
- PRIMARY KEY: id
- INDEX: portfolio_id
- UNIQUE: share_token
- FOREIGN KEY: portfolio_id → portfolios(id) ON DELETE CASCADE
- FOREIGN KEY: shared_with_user_id → users(user_id) ON DELETE CASCADE

---

#### 4.6.5 portfolio_views (포트폴리오 조회)

**설명**: 포트폴리오 조회 이력

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| id | BIGINT | NO | PK, AUTO_INCREMENT | - | 조회 ID |
| portfolio_id | BIGINT | NO | FK, INDEX | - | 포트폴리오 ID |
| viewer_user_id | INT | YES | FK | - | 조회자 ID (NULL=비로그인) |
| ip_address | VARCHAR(50) | YES | - | - | IP 주소 |
| viewed_at | DATETIME | NO | INDEX | CURRENT_TIMESTAMP | 조회일시 |

**인덱스**:
- PRIMARY KEY: id
- INDEX: portfolio_id, viewed_at
- FOREIGN KEY: portfolio_id → portfolios(id) ON DELETE CASCADE
- FOREIGN KEY: viewer_user_id → users(user_id) ON DELETE SET NULL

---

### 4.7 설문조사 (Survey)

#### 4.7.1 surveys (설문)

**설명**: 설문조사 메인

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| id | BIGINT | NO | PK, AUTO_INCREMENT | - | 설문 ID |
| title | VARCHAR(200) | NO | - | - | 제목 |
| description | TEXT | YES | - | - | 설명 |
| start_date | DATETIME | YES | INDEX | - | 시작일시 |
| end_date | DATETIME | YES | INDEX | - | 종료일시 |
| is_active | TINYINT(1) | NO | - | 1 | 활성 여부 |
| is_required | TINYINT(1) | NO | - | 0 | 필수 여부 |
| created_by | INT | NO | FK | - | 작성자 ID |
| created_at | DATETIME | NO | - | CURRENT_TIMESTAMP | 생성일시 |
| updated_at | DATETIME | YES | - | CURRENT_TIMESTAMP | 수정일시 |
| deleted_at | DATETIME | YES | INDEX | NULL | 삭제일시 |

**인덱스**:
- PRIMARY KEY: id
- INDEX: start_date, end_date, deleted_at
- FOREIGN KEY: created_by → users(user_id)

---

#### 4.7.2 survey_questions (설문 문항)

**설명**: 설문 질문

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| id | BIGINT | NO | PK, AUTO_INCREMENT | - | 문항 ID |
| survey_id | BIGINT | NO | FK, INDEX | - | 설문 ID |
| question_text | TEXT | NO | - | - | 질문 내용 |
| question_type | VARCHAR(20) | NO | - | - | 질문 유형 (SINGLE_CHOICE/MULTIPLE_CHOICE/TEXT/RATING) |
| is_required | TINYINT(1) | NO | - | 0 | 필수 여부 |
| order_num | INT | NO | - | 0 | 순서 |
| competency_id | BIGINT | YES | FK | - | 역량 ID (역량 진단용) |
| created_at | DATETIME | NO | - | CURRENT_TIMESTAMP | 생성일시 |
| updated_at | DATETIME | YES | - | CURRENT_TIMESTAMP | 수정일시 |

**인덱스**:
- PRIMARY KEY: id
- INDEX: survey_id
- FOREIGN KEY: survey_id → surveys(id) ON DELETE CASCADE
- FOREIGN KEY: competency_id → competencies(id) ON DELETE SET NULL

---

#### 4.7.3 survey_question_options (설문 선택지)

**설명**: 객관식 문항의 선택지

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| id | BIGINT | NO | PK, AUTO_INCREMENT | - | 선택지 ID |
| question_id | BIGINT | NO | FK, INDEX | - | 문항 ID |
| option_text | VARCHAR(200) | NO | - | - | 선택지 텍스트 |
| order_num | INT | NO | - | 0 | 순서 |
| score | INT | YES | - | - | 점수 (역량 진단용) |

**인덱스**:
- PRIMARY KEY: id
- INDEX: question_id
- FOREIGN KEY: question_id → survey_questions(id) ON DELETE CASCADE

---

#### 4.7.4 survey_responses (설문 응답)

**설명**: 설문 응답 (사용자별 설문 제출)

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| id | BIGINT | NO | PK, AUTO_INCREMENT | - | 응답 ID |
| survey_id | BIGINT | NO | FK, INDEX | - | 설문 ID |
| user_id | INT | NO | FK, INDEX | - | 사용자 ID |
| submitted_at | DATETIME | NO | - | CURRENT_TIMESTAMP | 제출일시 |

**인덱스**:
- PRIMARY KEY: id
- INDEX: survey_id, user_id
- UNIQUE: (survey_id, user_id) - 한 사용자당 한 번만 응답
- FOREIGN KEY: survey_id → surveys(id) ON DELETE CASCADE
- FOREIGN KEY: user_id → users(user_id) ON DELETE CASCADE

---

#### 4.7.5 survey_answers (설문 답변)

**설명**: 개별 문항에 대한 답변

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| id | BIGINT | NO | PK, AUTO_INCREMENT | - | 답변 ID |
| response_id | BIGINT | NO | FK, INDEX | - | 응답 ID |
| question_id | BIGINT | NO | FK, INDEX | - | 문항 ID |
| option_id | BIGINT | YES | FK | - | 선택지 ID (객관식) |
| answer_text | TEXT | YES | - | - | 답변 텍스트 (주관식) |
| answer_score | INT | YES | - | - | 답변 점수 |

**인덱스**:
- PRIMARY KEY: id
- INDEX: response_id, question_id
- FOREIGN KEY: response_id → survey_responses(id) ON DELETE CASCADE
- FOREIGN KEY: question_id → survey_questions(id) ON DELETE CASCADE
- FOREIGN KEY: option_id → survey_question_options(id) ON DELETE SET NULL

---

#### 4.7.6 survey_targets (설문 대상)

**설명**: 설문 대상 지정

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| id | BIGINT | NO | PK, AUTO_INCREMENT | - | 대상 ID |
| survey_id | BIGINT | NO | FK, INDEX | - | 설문 ID |
| target_type | VARCHAR(20) | NO | - | - | 대상 유형 (ALL/DEPARTMENT/GRADE/USER) |
| target_value | VARCHAR(100) | YES | - | - | 대상 값 (학과명, 학년 등) |
| user_id | INT | YES | FK | - | 특정 사용자 ID |

**인덱스**:
- PRIMARY KEY: id
- INDEX: survey_id
- FOREIGN KEY: survey_id → surveys(id) ON DELETE CASCADE
- FOREIGN KEY: user_id → users(user_id) ON DELETE CASCADE

---

### 4.8 외부취업가점 (External Employment Credits)

#### 4.8.1 external_employment (외부취업)

**설명**: 외부 자격증 및 취업 활동

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| id | BIGINT | NO | PK, AUTO_INCREMENT | - | ID |
| user_id | INT | NO | FK, INDEX | - | 사용자 ID |
| employment_type | VARCHAR(20) | NO | - | - | 유형 (CERTIFICATION/LANGUAGE/INTERNSHIP/CONTEST) |
| title | VARCHAR(200) | NO | - | - | 제목 |
| organization | VARCHAR(200) | YES | - | - | 발급/주최 기관 |
| acquisition_date | DATE | YES | - | - | 취득/활동 일자 |
| certificate_number | VARCHAR(100) | YES | - | - | 증명서 번호 |
| score | VARCHAR(50) | YES | - | - | 점수/등급 |
| credit_points | DECIMAL(5,2) | YES | - | 0 | 가점 점수 |
| status | VARCHAR(20) | NO | - | 'PENDING' | 상태 (PENDING/APPROVED/REJECTED) |
| approved_by | INT | YES | FK | - | 승인자 ID |
| approved_at | DATETIME | YES | - | - | 승인일시 |
| rejection_reason | TEXT | YES | - | - | 반려 사유 |
| file_path | VARCHAR(500) | YES | - | - | 증빙 파일 경로 |
| created_at | DATETIME | NO | - | CURRENT_TIMESTAMP | 생성일시 |
| updated_at | DATETIME | YES | - | CURRENT_TIMESTAMP | 수정일시 |
| deleted_at | DATETIME | YES | INDEX | NULL | 삭제일시 |

**인덱스**:
- PRIMARY KEY: id
- INDEX: user_id, deleted_at
- FOREIGN KEY: user_id → users(user_id) ON DELETE CASCADE
- FOREIGN KEY: approved_by → users(user_id) ON DELETE SET NULL

---

#### 4.8.2 external_employment_credit_rules (외부취업 가점 규칙)

**설명**: 외부취업 가점 부여 규칙

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| id | BIGINT | NO | PK, AUTO_INCREMENT | - | 규칙 ID |
| employment_type | VARCHAR(20) | NO | - | - | 유형 |
| category | VARCHAR(100) | YES | - | - | 카테고리 (예: TOEIC, 정보처리기사 등) |
| min_score | VARCHAR(50) | YES | - | - | 최소 점수/등급 |
| max_score | VARCHAR(50) | YES | - | - | 최대 점수/등급 |
| credit_points | DECIMAL(5,2) | NO | - | - | 가점 점수 |
| description | TEXT | YES | - | - | 설명 |
| is_active | TINYINT(1) | NO | - | 1 | 활성 여부 |
| created_at | DATETIME | NO | - | CURRENT_TIMESTAMP | 생성일시 |
| updated_at | DATETIME | YES | - | CURRENT_TIMESTAMP | 수정일시 |

**인덱스**:
- PRIMARY KEY: id

---

### 4.9 알림 (Notification)

#### 4.9.1 notifications (알림)

**설명**: 사용자 알림

| 컬럼명 | 데이터 타입 | NULL | 키 | 기본값 | 설명 |
|--------|------------|------|-----|--------|------|
| id | BIGINT | NO | PK, AUTO_INCREMENT | - | 알림 ID |
| user_id | INT | NO | FK, INDEX | - | 사용자 ID |
| type | VARCHAR(50) | NO | - | - | 알림 유형 (APPLICATION_APPROVED, COUNSELING_CONFIRMED 등) |
| title | VARCHAR(200) | NO | - | - | 제목 |
| message | TEXT | YES | - | - | 메시지 |
| link_url | VARCHAR(500) | YES | - | - | 링크 URL |
| is_read | TINYINT(1) | NO | INDEX | 0 | 읽음 여부 |
| read_at | DATETIME | YES | - | - | 읽은 시간 |
| created_at | DATETIME | NO | INDEX | CURRENT_TIMESTAMP | 생성일시 |

**인덱스**:
- PRIMARY KEY: id
- INDEX: user_id, is_read, created_at
- FOREIGN KEY: user_id → users(user_id) ON DELETE CASCADE

---

## 5. 관계 및 제약조건

### 5.1 주요 관계

#### 5.1.1 사용자 관련
- users 1:1 counselors (user_id = counselor_id)
- users 1:N program_applications
- users 1:N mileage_history
- users 1:N consultation_sessions
- users 1:1 portfolios

#### 5.1.2 프로그램 관련
- programs 1:N program_applications
- programs 1:N program_files
- programs 1:N program_reviews
- programs M:N competencies (through program_competencies)

#### 5.1.3 역량 관련
- competency_categories 1:N competencies
- competencies 1:N student_competency_assessments
- competencies 1:N survey_questions (역량 진단용)

#### 5.1.4 설문 관련
- surveys 1:N survey_questions
- surveys 1:N survey_responses
- survey_questions 1:N survey_question_options
- survey_questions 1:N survey_answers
- survey_responses 1:N survey_answers

#### 5.1.5 포트폴리오 관련
- portfolios 1:N portfolio_items
- portfolio_items 1:N portfolio_files
- portfolios 1:N portfolio_shares
- portfolios 1:N portfolio_views

### 5.2 Cascade 정책

| 관계 | ON DELETE | ON UPDATE |
|------|-----------|-----------|
| users → login_history | CASCADE | - |
| users → counselors | CASCADE | - |
| users → program_applications | CASCADE | - |
| programs → program_applications | CASCADE | - |
| programs → program_files | CASCADE | - |
| portfolios → portfolio_items | CASCADE | - |
| survey_responses → survey_answers | CASCADE | - |

---

## 6. 인덱스 전략

### 6.1 인덱스 목적
- **성능 향상**: 자주 검색되는 컬럼에 인덱스 설정
- **정렬 최적화**: ORDER BY 절에 사용되는 컬럼
- **조인 성능**: 외래키 컬럼에 인덱스

### 6.2 주요 인덱스

| 테이블 | 컬럼 | 인덱스 유형 | 목적 |
|--------|------|------------|------|
| users | student_num | UNIQUE | 학번 검색 |
| users | email | UNIQUE | 이메일 검색 |
| users | role | INDEX | 역할별 조회 |
| users | deleted_at | INDEX | Soft Delete 필터링 |
| programs | title | INDEX | 제목 검색 |
| programs | category | INDEX | 카테고리 필터링 |
| programs | status | INDEX | 상태 필터링 |
| program_applications | program_id, user_id | INDEX | 신청 조회 |
| program_applications | status | INDEX | 상태별 조회 |
| notifications | user_id, is_read | INDEX | 읽지 않은 알림 조회 |
| mileage_history | user_id, created_at | INDEX | 사용자별 마일리지 이력 |

---

## 7. 데이터베이스 설정

### 7.1 MySQL 설정

```sql
-- 데이터베이스 생성
CREATE DATABASE IF NOT EXISTS scms2
CHARACTER SET utf8mb4
COLLATE utf8mb4_unicode_ci;

-- 사용자 생성 및 권한 부여
CREATE USER 'scms_user'@'localhost' IDENTIFIED BY 'scms_password';
GRANT ALL PRIVILEGES ON scms2.* TO 'scms_user'@'localhost';
FLUSH PRIVILEGES;
```

### 7.2 Connection Pool 설정

```yaml
spring:
  datasource:
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
```

---

## 8. 백업 및 복구

### 8.1 백업 전략
- **전체 백업**: 매일 자정 (0:00)
- **증분 백업**: 매 6시간마다
- **보관 기간**: 30일

### 8.2 백업 명령어

```bash
# 전체 백업
mysqldump -u scms_user -p scms2 > backup_$(date +%Y%m%d).sql

# 압축 백업
mysqldump -u scms_user -p scms2 | gzip > backup_$(date +%Y%m%d).sql.gz
```

### 8.3 복구 명령어

```bash
# 복구
mysql -u scms_user -p scms2 < backup_20251118.sql

# 압축 파일 복구
gunzip < backup_20251118.sql.gz | mysql -u scms_user -p scms2
```

---

## 9. 성능 최적화

### 9.1 쿼리 최적화
- N+1 문제 해결: fetch join, EntityGraph 사용
- 페이징 처리: LIMIT, OFFSET 사용
- 불필요한 컬럼 조회 방지: SELECT * 지양

### 9.2 인덱스 최적화
- 복합 인덱스 고려: (user_id, created_at) 등
- 인덱스 사용률 모니터링
- 사용하지 않는 인덱스 제거

### 9.3 파티셔닝 (향후 검토)
- login_history: 월별 파티셔닝
- mileage_history: 년도별 파티셔닝
- notifications: 읽음/읽지않음 파티셔닝

---

## 10. 보안 고려사항

### 10.1 비밀번호 암호화
- BCrypt 알고리즘 사용
- Salt 값 자동 생성
- 강도: 10 rounds

### 10.2 민감 데이터 보호
- 개인정보 암호화 (주민번호 등 - 현재 미사용)
- 접근 로그 기록 (login_history)
- 권한 기반 데이터 접근 제어

### 10.3 SQL Injection 방어
- Prepared Statement 사용 (JPA 기본)
- 파라미터 바인딩
- 사용자 입력 검증

---

## 11. 데이터 마이그레이션

### 11.1 Flyway (향후 도입 검토)
```yaml
spring:
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
```

### 11.2 JPA DDL Auto
```yaml
spring:
  jpa:
    hibernate:
      ddl-auto: update  # 개발: update, 운영: validate
```

---

## 12. 모니터링

### 12.1 모니터링 항목
- 커넥션 풀 사용률
- 슬로우 쿼리 로그
- 테이블 크기 증가율
- 인덱스 사용률

### 12.2 슬로우 쿼리 설정
```sql
-- 1초 이상 쿼리 로깅
SET GLOBAL slow_query_log = 'ON';
SET GLOBAL long_query_time = 1;
```

---

## 13. 참고 자료

### 13.1 관련 문서
- [시스템 아키텍처 설계서](./01_시스템아키텍처설계서.md)
- [API 명세서](./03_API명세서.md)
- [Database Schema SQL](../../database/schema.sql)

### 13.2 외부 참조
- MySQL Documentation: https://dev.mysql.com/doc/
- Spring Data JPA Reference: https://spring.io/projects/spring-data-jpa
- Hibernate ORM Documentation: https://hibernate.org/orm/documentation/

---

## 14. 버전 이력

| 버전 | 날짜 | 작성자 | 변경 내용 |
|------|------|--------|----------|
| 1.0 | 2025-11-18 | 개발팀 | 최초 작성 |

---

**문서 작성일**: 2025-11-18
**최종 검토자**: 개발팀
**승인일**: 2025-11-18
